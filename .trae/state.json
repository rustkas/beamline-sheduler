{
  "project": "beamline-constructor",
  "version": "1.0",
  "current_cp": "CP1-LC",
  "no_drift": true,
  "project_clarification": {
    "devstate_disclaimer": "ВАЖНО: DevState - это отдельный, побочный продукт, который НЕ связан с целью проекта Beamline Constructor. DevState служит только для управления состоянием разработки и не является частью AI-фабрики или оркестрации AI-агентов.",
    "project_focus": "Beamline Constructor создает операционную систему для AI-фабрик и оркестрации AI-процессов. Управление состоянием разработки через .trae и DevState НЕ является частью продуктовой логики проекта.",
    "core_vision": "Операционная система для AI-фабрик - оркестратор 'фабрик искусственного интеллекта' (AI Production Line)",
    "core_components": {
      "description": "Ядро продукта состоит из 5 ключевых компонентов. Все остальные подпроекты являются вспомогательными инструментами разработки.",
      "components": [
        "C-Gateway (apps/c-gateway/) - HTTP REST API entry point",
        "Router (apps/otp/router/) - Erlang/OTP orchestrator",
        "Worker Rust (apps/worker/) - Rust compute engine",
        "UI (apps/ui_web/) - Phoenix LiveView interface",
        "Extensions - Pluggable NATS services (pre/validator/post/provider)"
      ],
      "supporting_tools": [
        "Usage Service (metrics)",
        "Proto/SQL (contracts)",
        "DevState, Scripts, Tools (dev tooling)",
        "Infrastructure, Backend (infra)",
        "Documentation (docs)"
      ],
      "extensions_note": "LLM/API adapters (OpenAI, Anthropic, CRM, RAG) реализуются как Custom Provider Extensions - отдельные NATS-сервисы в Extension Registry. См. docs/EXTENSIONS_API.md"
    },
    "excluded_from_scope": [
      "DevState",
      "управление состоянием разработки",
      ".trae файлы как часть продукта"
    ]
  },
  "agents": [
    {
      "id": "AGENT_1_REPO_STATE",
      "name": "Repo/State Bootstrap",
      "task": "Specify monorepo and project state",
      "cp": "CP0-LC",
      "status": "completed",
      "started_at": "2025-11-05T09:37:52Z",
      "updated_at": "2025-11-05T13:31:22Z"
    },
    {
      "id": "AGENT_4_C_GATEWAY",
      "name": "C-Gateway (C11)",
      "task": "HTTP REST API gateway with NATS integration, JSON DTO parsing (jansson), rate limiting, health checks",
      "cp": "CP1-LC",
      "status": "completed",
      "started_at": "2025-11-12T09:00:00Z",
      "updated_at": "2025-11-18T11:25:00Z",
      "notes": "Migrated from TypeScript/NestJS to C11 implementation. Located at apps/c-gateway/. Supports both stub and real NATS client modes."
    },
    {
      "id": "AGENT_2_ROUTER_OTP",
      "name": "Router (Erlang/OTP)",
      "task": "CP1-ROUTER partial: observability (JSONL logger, duration unification, error mapping), test subsystem optimized",
      "cp": "CP1-LC",
      "status": "completed",
      "started_at": "2025-11-12T20:00:00Z",
      "updated_at": "2025-11-18T12:00:00Z",
      "notes": "CP1-ROUTER fully complete: RBAC system (router_rbac, router_permissions, router_audit), Policy Enforcement (router_quota), Rate Limiting (router_rate_limiter), all integrated with admin gRPC and decide endpoint. Unit and integration tests passing. Phase 3 (Production Readiness) complete."
    },
    {
      "id": "AGENT_3_WORKER_RUST",
      "name": "Worker 3 (Rust)",
      "task": "High-performance, modular execution runtime. Replaces CAF worker.",
      "cp": "CP3-LC",
      "status": "completed",
      "started_at": "2025-11-28T10:00:00Z",
      "updated_at": "2025-12-28T12:00:00Z",
      "notes": "Implemented in Rust (apps/worker). Features: NATS protocol, HTTP/Scripting/DB/FS handlers, Observability (Prometheus/Logs), Sandbox, DLQ. Replaces C++/CAF implementation."
    },
    {
      "id": "AGENT_5_UI_WEB",
      "name": "UI-Web (Phoenix LiveView)",
      "task": "Replace SvelteKit with Phoenix LiveView, integrate with C-Gateway",
      "cp": "CP4",
      "status": "completed",
      "started_at": "2025-11-20T00:00:00Z",
      "updated_at": "2025-12-28T12:00:00Z",
      "notes": "SvelteKit application removed. Phoenix LiveView project active at apps/ui_web. Setup and core structure in place."
    }
  ],
  "artifact_checksums": [
    {
      "path": "proto/buf.yaml",
      "hash": "852ecb99e7c585e6061f3165706e0813770dab288cb6da6919c7d98ea77845f0",
      "ts": "2025-11-11T00:00:00Z"
    },
    {
      "path": "proto/buf.gen.yaml",
      "hash": "85ec3bbdde71aa704bedf3aae450031f9a4ab696f786540b0d59f8e8cc914d5b",
      "ts": "2025-11-11T00:00:00Z"
    },
    {
      "path": "sql/000_init.sql",
      "hash": "9b76c73b6773148e821e3cf7abd7846a8abcf2071b7bcfe3281758c07245aa4c",
      "ts": "2025-11-16T11:01:15Z"
    },
    {
      "path": "docs/NATS_SUBJECTS.md",
      "hash": "ef7ca53362e9e8d4941f831a1f96a086e403654a36bfafdbc9dadc927c7f8d95",
      "ts": "2025-11-27T12:58:43Z"
    },
    {
      "path": "docs/ROUTING_POLICY.md",
      "hash": "c9dd402dbef1cf068ee38b04af7ee6194f5fe24aea49f9b35417e731a97bf119",
      "ts": "2025-11-27T12:58:43Z"
    },
    {
      "path": "docs/STATE.schema.json",
      "hash": "69d1372ac194ec3ab1361886f6041a6f7b8d479453ec0925d38d1ac59ff82ce2",
      "ts": "2025-11-11T00:00:00Z"
    },
    {
      "path": "docs/CP1_ACCEPTANCE_REPORT.md",
      "hash": "8352344c21939c2c246358fd55a15d60745cf9edaff5500421f9525ac67c5bb5",
      "ts": "2025-11-27T12:58:43Z"
    },
    {
      "path": "docs/WORKER3_SPEC.md",
      "hash": "987b36280ffbf94d871b4017a82314243ddecea71d5f49aa7851a5eba648f4f8",
      "ts": "2025-11-12T10:00:00Z"
    },
    {
      "path": "apps/otp/router/rebar.config",
      "hash": "60c93db2b33fbefa7fde33de6f6f7de4f2dbb97813d2f3ca7a10e520bf7481ef",
      "ts": "2025-11-27T09:18:00Z"
    },
    {
      "path": "apps/otp/router/Makefile",
      "hash": "8582d0f030ce529de101bb4934575aa3e679b020eff85f7d91567435331e8710",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/c-gateway/CMakeLists.txt",
      "hash": "7001af3e499fcb795e9284ba9356aaa59c1bc3fe881f78491a62cc8165eca81b",
      "ts": "2025-11-27T12:58:43Z"
    },
    {
      "path": ".github/workflows/ci.yml",
      "hash": "f6b4081308e1f0096514f55c9c110ad6174d4c5c77ea24f4cf4278fbdc325f8c",
      "ts": "2025-11-27T13:10:00Z"
    },
    {
      "path": "apps/caf/processor/CMakeLists.txt",
      "hash": "afb3e8defe6a2139d4dbcc5f9206b8b863c98994b8ec7dcb5f61e5652720bf80",
      "ts": "2025-11-17T12:00:00Z"
    },
    {
      "path": "apps/caf/processor/include/beamline/worker/core.hpp",
      "hash": "c67abaeafee4895e9ab53187d8546f386004efef65103c492123d0c20fb88678",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/include/beamline/worker/actors.hpp",
      "hash": "73b4b521cf4c44674ba043d2082a9a50b7c8900e91f2bd833b94874a5c474656",
      "ts": "2025-11-17T12:00:00Z"
    },
    {
      "path": "apps/caf/processor/include/beamline/worker/observability.hpp",
      "hash": "e7a8012506fa76e5eeae1c09ce93ec1fc8b8c859cd1977d54ee4d7ab770ed5ee",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/main.cpp",
      "hash": "50733ca7abe542f58c10c8d8290246f1133a24237f1870a9a322fcf6b0bcd42a",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/worker_actor.cpp",
      "hash": "0c87c9d44d083102ec628dd4595785e6aed547b144fc77efce64b17a496e0fce",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/block_executor.cpp",
      "hash": "04435d3c3f528b38554864628b9ba6a1506bfd91e4ba55b58110f74e938042e4",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/scheduler.cpp",
      "hash": "f16db81a7390a3ad7ddaa8cff1ebeac00d86c2f352b5086a5af7b95830d1a6d9",
      "ts": "2025-11-17T12:00:00Z"
    },
    {
      "path": "apps/caf/processor/src/sandbox.cpp",
      "hash": "3616700f2658d8ac81810b673a5de3edc7858b76375b23aba408e4ebc92fef9c",
      "ts": "2025-11-17T12:00:00Z"
    },
    {
      "path": "apps/caf/processor/src/observability.cpp",
      "hash": "439c90da2ab2d971415049fddeec172a87b27bbae9ce2ed4511962b2de4cd45c",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/blocks/http_block.cpp",
      "hash": "122fc3106a0a3b212fc4ed7109a138a2a1d77488d1fbd87a393f9f213c30d354",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/blocks/fs_block.cpp",
      "hash": "c8984ce67f9a3bdaf88beca063e8b68437e87048cec4f32937235a54f379acd2",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/blocks/sql_block.cpp",
      "hash": "21a5b26f3a548893c0bd032406f8fa79bd4c2ebc895d06abf0b1a562cc4561ff",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/src/blocks/human_block.cpp",
      "hash": "ed7e2a2252693f5a15035ec981776a86003a4dbb48b1a9fc85ba97f93e24683c",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/tests/CMakeLists.txt",
      "hash": "098d089b0034831aca8158aea71bc0aae8cf86c3994e90ffc9f71a4ce4c5467c",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/tests/test_core.cpp",
      "hash": "d46021ec94fc997589c4fea9c8ac03a6003e6b622d8464ab3f41ff219336d0bf",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/tests/test_block_executor.cpp",
      "hash": "076731c39a09b038a01bab05d4faca9a6c9edb9a4631805b5ee9e2b3d25fd2c1",
      "ts": "2025-11-26T11:46:30Z"
    },
    {
      "path": "apps/caf/processor/README.md",
      "hash": "298c2a555dfa9c52845e738dce481846f954a927bc3b9699ca852b00dd69fed0",
      "ts": "2025-11-17T12:00:00Z"
    },
    {
      "path": ".trae/history.json",
      "hash": "ac7e5197c6592613edbd3d39553e225f4c626f018118c74c3d12a720eb265553",
      "ts": "2025-11-27T13:10:00Z"
    },
    {
      "path": "docs/CP2_CHECKLIST.md",
      "hash": "9a34ee544e43fbc50b112449dc47537eedc3b66a53898133c7d70044c9a6af16",
      "ts": "2025-11-27T13:10:00Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/router_jetstream.erl",
      "hash": "1ada76d1ef5caec19849436ec6336fc67943adbc3faec78cc7825531a21c9861",
      "ts": "2026-01-16T03:42:31Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/router_idem.erl",
      "hash": "3c44e4208c35bdb1f38c1ad733b93dcc921be41228fbce6fd21e1d6ba5f70d41",
      "ts": "2026-01-16T03:42:31Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/router_acl.erl",
      "hash": "107c7b9efe6d95a89ef8bc6f34ee4a0d514353274eef1a130e89003a318cf347",
      "ts": "2026-01-16T03:42:31Z"
    },
    {
      "path": "apps/otp/router/test/router_idem_SUITE.erl",
      "hash": "15c395e50f3ec31ef7f5ce9289d1eba8b67358832127417894a2d9bf7ba61271",
      "ts": "2025-11-27T09:10:00Z"
    },
    {
      "path": "apps/c-gateway/src/admin_grpc.c",
      "hash": "b6136e4fc53b8e89cef884f5df7ad5c44aee5b912e404646da90612161986d3a",
      "ts": "2025-11-27T13:10:00Z"
    },
    {
      "path": "apps/c-gateway/tests/admin_grpc_test.c",
      "hash": "170d7d526114c7319830bf9f6bcf4921ffdb6ba4f1fc9a2d1b07b0717fbfc886",
      "ts": "2025-11-27T13:10:00Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/router_nats.erl",
      "hash": "0b8d08c7a855eb9b213e5ec9e94d5e30c09cf3fcc5d9a310daf8c0f82048746e",
      "ts": "2026-01-16T03:42:31Z"
    },
    {
      "path": "apps/otp/router/test/router_metrics_dump_SUITE.erl",
      "hash": "f773eb08d077b7765cbc42ba6cc18a5bb6f6078ac178287457e8e780920f38a9",
      "ts": "2025-11-27T12:58:43Z"
    },
    {
      "path": "apps/otp/router/test/router_telemetry_SUITE.erl",
      "hash": "d3e26d42dea0a8fe4b3ad6a09beaa92ce5654312d74c3434565d4db1f17e1555",
      "ts": "2025-11-27T10:00:00Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/router_metrics_http.erl",
      "hash": "6cc8b48e23961c232a509b0c19df3aa2075a534d0d8a1959cb08b2137b796b84",
      "ts": "2026-01-16T03:42:31Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/router_prometheus.erl",
      "hash": "70546c22634b075f19c03f57e6e84fda81f066c3c359e8ba4a1f0e5823e0efc1",
      "ts": "2026-01-16T03:42:31Z"
    },
    {
      "path": "apps/otp/router/test/router_metrics_http_SUITE.erl",
      "hash": "2f4493d789da3bde05e296f73580eac3e3acc6bfe37719614dde71e1a0a1b7b2",
      "ts": "2025-11-27T10:20:00Z"
    },
    {
      "path": "apps/otp/router/apps/beamline_router/src/beamline_router_sup.erl",
      "hash": "dbdca7f6160846934d4f162f20c8ccb6f995b4674da79c8d809b429176075deb",
      "ts": "2026-01-16T03:42:31Z"
    }
  ],
  "artifact_checksums_extra": [],
  "updated_at": "%s",
  "transition_intent": {
    "target_cp": "CP2-LC",
    "status": "planned",
    "gate": "devstate",
    "trace_id": "pending-devstate",
    "prepared_at": "2025-11-26T21:00:00Z"
  },
  "governance": {
    "cp2_classification": {
      "enabled": true,
      "note": "Any new JetStream/Idempotency/ACL/Admin gRPC features are CP2 work and tracked in CP2 checklist",
      "effective_from": "2025-11-27T08:55:44Z"
    }
  },
  "cp2_checklist": {
    "status": "planned",
    "artifact": "docs/CP2_CHECKLIST.md",
    "items": [
      {
        "name": "JetStream durability & redelivery",
        "status": "planned",
        "module": "apps/otp/router/src/router_jetstream.erl",
        "tests": "apps/otp/router/test/router_jetstream_SUITE.erl",
        "metrics": [
          "router_jetstream_ack_total",
          "router_redelivery_total",
          "router_dlq_total"
        ]
      },
      {
        "name": "Idempotency layer",
        "status": "planned",
        "module": "apps/otp/router/src/router_idem.erl",
        "tests": "apps/otp/router/test/router_idem_SUITE.erl",
        "metrics": [
          "router_idem_hits_total",
          "router_idem_miss_total"
        ]
      },
      {
        "name": "ACL",
        "status": "planned",
        "module": "apps/otp/router/src/router_acl.erl",
        "tests": "apps/otp/router/test/router_acl_SUITE.erl",
        "metrics": [
          "router_acl_denied_total",
          "router_acl_allowed_total"
        ]
      },
      {
        "name": "Admin gRPC",
        "status": "planned",
        "module": "apps/c-gateway/src/admin_grpc.c",
        "tests": "apps/c-gateway/tests/admin_grpc_test.c",
        "metrics": [
          "gateway_admin_requests_total",
          "gateway_admin_errors_total"
        ]
      },
      {
        "name": "Headers propagation",
        "status": "planned",
        "module": "apps/otp/router/src/router_headers.erl",
        "tests": "apps/otp/router/test/router_headers_SUITE.erl",
        "metrics": [
          "ctx_missing_headers_total"
        ]
      },
      {
        "name": "Observability expansion",
        "status": "planned",
        "module": "apps/otp/router/src/router_observability.erl",
        "tests": "apps/otp/router/test/router_observability_SUITE.erl",
        "metrics": [
          "router_span_duration_seconds",
          "router_error_total"
        ]
      },
      {
        "name": "CI DevState gates",
        "status": "planned",
        "module": "devstate-tools/devstate/scripts/devstate_verify.sh",
        "tests": ".github/workflows/ci.yml",
        "metrics": []
      }
    ]
  },
  "migration_params": {
    "service_name": "core-gateway",
    "rss_mb": 180,
    "target_rps": 2000,
    "peak_rps": 4000,
    "stage": "CP3-LC",
    "sunset_days": 30
  },
  "observability_artifacts": {
    "k6_scripts": {
      "status": "ready",
      "path": "k6/scripts/",
      "description": "k6 load testing scripts - ready for throughput validation",
      "ready_for": "CP3-LC throughput testing",
      "reason": "Worker Rust implementation complete"
    },
    "grafana_dashboards": {
      "status": "deferred",
      "path": "grafana/dashboards/",
      "description": "Grafana dashboards - deferred to Pre-Release phase",
      "deferred_to": "Pre-Release",
      "reason": "Requires infrastructure resources"
    },
    "prometheus_rules": {
      "status": "deferred",
      "path": "prometheus/rules/",
      "description": "Prometheus alerting rules - deferred to Pre-Release phase",
      "deferred_to": "Pre-Release",
      "reason": "Requires infrastructure resources"
    },
    "actual": {
      "description": "Worker Rust implementation with comprehensive observability",
      "worker_metrics": {
        "paths": [
          "apps/worker/src"
        ],
        "description": "Prometheus metrics for worker performance monitoring"
      },
      "worker_tracing": {
        "paths": [
          "apps/worker/src"
        ],
        "description": "OpenTelemetry tracing for step execution"
      },
      "worker_logging": {
        "paths": [
          "apps/worker/src"
        ],
        "description": "Structured JSON logging with correlation IDs"
      }
    }
  }
}