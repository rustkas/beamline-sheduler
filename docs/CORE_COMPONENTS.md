# BeamLine Constructor: Core Components

> **ĞšĞ»ÑÑ‡ĞµĞ²Ğ¾Ğµ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ**: Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ 5 ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² ÑĞ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑÑ‚ ÑĞ´Ñ€Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ° BeamLine Constructor. Ğ’ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñ‹ ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸.

---

## ğŸ¯ Ğ¯Ğ´Ñ€Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ° (Core Components)

### 1. C-Gateway

**ĞŸÑƒÑ‚ÑŒ**: `apps/c-gateway/`  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… Completed (CP1-LC)  
**Ğ¯Ğ·Ñ‹Ğº**: C11  
**Ğ Ğ¾Ğ»ÑŒ**: HTTP REST API Gateway

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸**:
- Entry point Ğ´Ğ»Ñ Ğ²ÑĞµÑ… HTTP ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ¾Ğ²
- HTTP â†” NATS adapter (CP1 ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚)
- JSON DTO parsing Ğ¸ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ
- Rate limiting Ğ¸ health checks
- ĞĞµ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Extensions (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Router Ğ·Ğ½Ğ°ĞµÑ‚)

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ›ĞµĞ³ĞºĞ¾Ğ²ĞµÑĞ½Ñ‹Ğ¹, Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ (10x Ğ¼ĞµĞ½ÑŒÑˆĞµ Ğ¿Ğ°Ğ¼ÑÑ‚Ğ¸ vs TypeScript/NestJS)

---

### 2. Router

**ĞŸÑƒÑ‚ÑŒ**: `apps/otp/router/`  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… Completed (CP1-LC)  
**Ğ¯Ğ·Ñ‹Ğº**: Erlang/OTP  
**Ğ Ğ¾Ğ»ÑŒ**: Ğ¦ĞµĞ½Ñ‚Ñ€Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ğ¾Ñ€ĞºĞµÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€ Ğ¼Ğ°Ñ€ÑˆÑ€ÑƒÑ‚Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸**:
- Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Extensions pipeline: `pre â†’ validator â†’ provider â†’ post`
- Routing Policy Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ (weights, sticky, fallback)
- Extension Registry lookup
- NATS orchestration
- RBAC Ğ¸ tenant validation

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ•Ğ´Ğ¸Ğ½ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ğ·Ğ½Ğ°ĞµÑ‚ Ğ¾ Extensions Ğ¸ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ¸Ñ… Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğ°Ğ¼Ğ¸

---

### 3. Worker

**ĞŸÑƒÑ‚ÑŒ**: `apps/worker/`  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: âœ… Completed (CP3-LC)  
**Ğ¯Ğ·Ñ‹Ğº**: Rust  
**Ğ Ğ¾Ğ»ÑŒ**: Ğ’Ñ‹ÑĞ¾ĞºĞ¾Ğ½Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ½Ñ‹Ğ¹ compute engine

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸**:
- Actor-based runtime Ğ´Ğ»Ñ Ğ¿Ğ°Ñ€Ğ°Ğ»Ğ»ĞµĞ»ÑŒĞ½Ñ‹Ñ… Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹
- BlockExecutor: HTTP, FS, SQL, Human approval Ğ±Ğ»Ğ¾ĞºĞ¸
- Resource pools (CPU/GPU/IO)
- Observability: Prometheus metrics, OpenTelemetry tracing

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: ĞĞ°Ñ‚Ğ¸Ğ²Ğ½Ğ°Ñ Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚ÑŒ Ğ´Ğ»Ñ compute-intensive Ğ·Ğ°Ğ´Ğ°Ñ‡

---

### 4. UI

**ĞŸÑƒÑ‚ÑŒ**: `apps/ui-web/`  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: ğŸš§ Migration in Progress (SvelteKit â†’ Phoenix LiveView)  
**Ğ¯Ğ·Ñ‹Ğº**: Elixir  
**Ğ Ğ¾Ğ»ÑŒ**: Ğ’ĞµĞ±-Ğ¸Ğ½Ñ‚ĞµÑ€Ñ„ĞµĞ¹Ñ Ğ´Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¸ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

**Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸**:
- Dashboard (Ğ¾Ğ±Ğ·Ğ¾Ñ€ ÑĞ¸ÑÑ‚ĞµĞ¼Ñ‹)
- Messages (ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸ÑĞ¼Ğ¸)
- Policies (Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Routing Policies)
- Usage (Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ¸ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³)
- Extensions Registry UI

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ‚Ğ¾Ñ‡ĞºĞ° ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ÑĞµĞ¹ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ¾Ğ¹

---

### 5. Extensions

**Ğ¢Ğ¸Ğ¿**: NATS-ÑĞµÑ€Ğ²Ğ¸ÑÑ‹ (pluggable architecture)  
**Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ**: Architecture defined, API documented  
**Ğ¯Ğ·Ñ‹ĞºĞ¸**: Ğ›ÑĞ±Ñ‹Ğµ (Go, Rust, Erlang, Python, C Ğ¸ Ñ‚.Ğ´.)  
**Ğ Ğ¾Ğ»ÑŒ**: Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ ĞºĞ¾Ğ´Ğ° ÑĞ´Ñ€Ğ°

**Ğ¢Ğ¸Ğ¿Ñ‹ Extensions**:
- **Pre-processors**: ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ²Ñ…Ğ¾Ğ´ÑÑ‰Ğ¸Ñ… ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğ¹
- **Validators**: ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¸ Ğ±Ğ»Ğ¾ĞºĞ¸Ñ€Ğ¾Ğ²ĞºĞ° (PII guard, rate limits)
- **Post-processors**: ĞœĞ¾Ğ´Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ² Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ğ¾Ğ²
- **Custom Providers**: Ğ¡Ğ¾Ğ±ÑÑ‚Ğ²ĞµĞ½Ğ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ¹Ğ´ĞµÑ€Ñ‹ (RAG, CRM, etc.)

**ĞšĞ»ÑÑ‡ĞµĞ²Ğ°Ñ Ğ¾ÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚ÑŒ**: Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ³Ğ¾ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¾Ğ½Ğ°Ğ»Ğ° Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (Extension Registry + Routing Policy), Ğ±ĞµĞ· Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ C-Gateway/Router/Worker

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ**: `docs/EXTENSIONS_API.md`, `docs/EXTENSIONS_API_RU.md`

---

## ğŸ” Cross-Cutting Observability Invariants (CP1)

Observability Ğ² CP1 â€” ÑÑ‚Ğ¾ **Ğ½Ğµ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞµÑ€Ğ²Ğ¸Ñ**, Ğ° Ğ½Ğ°Ğ±Ğ¾Ñ€ Ğ¸Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ğ¾Ğ², ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ ÑĞ¾Ğ±Ğ»ÑĞ´Ğ°Ñ‚ÑŒÑÑ Ğ²ÑĞµĞ¼Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°Ğ¼Ğ¸ ÑĞ´Ñ€Ğ°.

### ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ˜Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹

#### 1. Structured JSON Logging

Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ² ĞµĞ´Ğ¸Ğ½Ğ¾Ğ¼ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ JSON Ñ Ğ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸:

**Ğ’ÑĞµĞ³Ğ´Ğ° Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚:**
- `timestamp` (ISO 8601)
- `level` (ERROR, WARN, INFO, DEBUG)
- `component` (router, gateway, worker, provider, usage)
- `message` (human-readable)

**ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹ Ğ¿Ñ€Ğ¸ Ğ½Ğ°Ğ»Ğ¸Ñ‡Ğ¸Ğ¸ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚Ğ° (CP1 invariants):**
- `tenant_id` - ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ tenant context (Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹)
- `run_id` - ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ run context (Router, Worker, Gateway)
- `flow_id` - ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ flow context (Router, Worker)
- `step_id` - ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ step context (Worker, Router)
- `trace_id` - ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ trace context (Ğ²ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ»Ñ distributed tracing)

**ĞĞ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ:**
- `error_code` - Ğ´Ğ»Ñ ERROR level (structured error handling)
- `latency_ms` - Ğ´Ğ»Ñ performance tracking
- `context` - Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚

**ĞŸÑ€Ğ¸Ğ¼ĞµÑ€:**
```json
{
  "timestamp": "2025-01-27T12:00:00Z",
  "level": "INFO",
  "component": "router",
  "message": "Routing decision made",
  "tenant_id": "tenant_123",
  "run_id": "run_abc123",
  "flow_id": "flow_xyz789",
  "trace_id": "trace_def456",
  "context": {
    "provider": "openai",
    "latency_ms": 250
  }
}
```

**PII Filtering**: Ğ’ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ¸ PII Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¼Ğ°ÑĞºĞ¸Ñ€ÑƒÑÑ‚ÑÑ (`[REDACTED]`).

**ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ**: `config/observability/logging.json`

#### 2. Health Endpoints

Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ¿Ñ€ĞµĞ´Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ÑÑ‚ÑŒ health-Ğ¸Ğ½Ğ´Ğ¸ĞºĞ°Ñ‚Ğ¾Ñ€Ñ‹:

- **Router (Erlang/OTP)**: gRPC health service Ğ½Ğ° Ğ¿Ğ¾Ñ€Ñ‚Ñƒ 9000
  - Protocol: gRPC
  - Service: `grpc.health.v1.Health/Check`
  - Verification: `grpc_health_probe -addr=localhost:9000`
  - Response: Protobuf Ñ `status` enum (SERVING/UNKNOWN/NOT_SERVING)

- **Gateway (C-Gateway)**: HTTP `GET /_health` Ğ¸Ğ»Ğ¸ `GET /health`
  - Protocol: HTTP
  - Port: 3000 (default)
  - Response: JSON Ñ `status`, `timestamp` Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸

- **Worker CAF (C++/CAF)**: HTTP `GET /_health`
  - Protocol: HTTP
  - Response: JSON Ñ `status`, `timestamp` Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸
  - Note: Ğ”Ğ»Ñ Worker Ğ±ĞµĞ· HTTP ÑĞµÑ€Ğ²ĞµÑ€Ğ° - Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ° Ğ¸Ğ»Ğ¸ file-based health indicator

- **Ingress (Python)**: HTTP `GET /_health` (liveness), `GET /_readyz` (readiness)
  - Response: `200 OK` Ñ body `ok` (liveness) Ğ¸Ğ»Ğ¸ `ready` (readiness)

#### 3. Trace ID Propagation

Ğ’ÑĞµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ñ€Ğ¸Ğ²ÑĞ·Ğ°Ğ½Ñ‹ Ğº `trace_id` / `run_id` Ğ´Ğ»Ñ ÑĞºĞ²Ğ¾Ğ·Ğ½Ğ¾Ğ³Ğ¾ Ñ‚Ñ€ĞµĞ¹ÑĞ¸Ğ½Ğ³Ğ°:

- Router: Ğ¸Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ `trace_id` Ğ¸Ğ· NATS headers, Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ Ğ² Ğ»Ğ¾Ğ³Ğ¸
- Gateway: Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ `trace_id` Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ², Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ Ğ² NATS headers
- Worker: Ğ¸Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ `trace_id` Ğ¸Ğ· NATS message headers, Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ Ğ² Ğ»Ğ¾Ğ³Ğ¸
- Provider: Ğ¸Ğ·Ğ²Ğ»ĞµĞºĞ°ĞµÑ‚ `trace_id` Ğ¸Ğ· NATS message headers, Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ Ğ² Ğ»Ğ¾Ğ³Ğ¸

#### 4. ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞœĞµÑ‚Ñ€Ğ¸ĞºĞ¸ (CP1)

Ğ”Ğ°Ğ¶Ğµ ĞµÑĞ»Ğ¸ Prometheus Ğ½Ğµ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ Ğ² CP1, ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ñ‹:

- Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¼ĞµÑ‚Ñ€Ğ¸ĞºĞ¸ Ğ² ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¼ Ğ²Ğ¸Ğ´Ğµ (latency_ms, error_code)
- ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ğ´Ğ»Ñ Ğ±ÑƒĞ´ÑƒÑ‰ĞµĞ¹ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸ Ñ Prometheus
- ĞĞµ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ `/metrics` endpoint Ğ² CP1 (Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ»Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ±Ğ¾Ñ€)

### Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Observability

**Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸:**

- `scripts/observability/validate_observability.sh` - Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¸ health endpoints
- `scripts/observability/run_obs1_validators.sh` - OBS-1 conformance validation
- Ğ›Ğ¾ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸: `bash scripts/observability/validate_observability.sh`

**Ğ§ĞµĞºĞ»Ğ¸ÑÑ‚ Ğ´Ğ»Ñ CP1:**

- âœ… Ğ’ÑĞµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ»Ğ¾Ğ³Ğ¸Ñ€ÑƒÑÑ‚ Ğ² JSON Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğµ
- âœ… ĞĞ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ¿Ñ€Ğ¸ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒÑÑ‚ (timestamp, level, component, message)
- âœ… CP1 Ğ¸Ğ½Ğ²Ğ°Ñ€Ğ¸Ğ°Ğ½Ñ‚Ñ‹ ÑĞ¾Ğ±Ğ»ÑĞ´Ğ°ÑÑ‚ÑÑ (tenant_id, run_id, flow_id, step_id, trace_id ĞºĞ¾Ğ³Ğ´Ğ° Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹)
- âœ… Health endpoints Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°ÑÑ‚ (Router gRPC, Gateway/Worker HTTP)
- âœ… PII Ğ¸ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ¼Ğ°ÑĞºĞ¸Ñ€ÑƒÑÑ‚ÑÑ
- âœ… Trace ID Ğ¿ĞµÑ€ĞµĞ´Ğ°ĞµÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· NATS headers

**Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ:**

- `docs/OBSERVABILITY.md` - Ğ¾Ğ±Ñ‰Ğ¸Ğµ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- `docs/OBSERVABILITY_CONVENTIONS.md` - Ğ´ĞµÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ½Ğ²ĞµĞ½Ñ†Ğ¸Ğ¸
- `docs/OBSERVABILITY_HEALTH_ENDPOINTS.md` - health endpoints Ğ´Ğ»Ñ Ğ²ÑĞµÑ… ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²
- `config/observability/logging.json` - ÑÑ…ĞµĞ¼Ğ° Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ²

**Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ğ¸:**

- `scripts/observability/validate_observability.sh` - Ğ±Ğ°Ğ·Ğ¾Ğ²Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ° Ğ»Ğ¾Ğ³Ğ¾Ğ² Ğ¸ health endpoints
- `scripts/observability/validate_observability_e2e.sh` - ÑĞºĞ²Ğ¾Ğ·Ğ½Ğ°Ñ Ğ²Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ observability (E2E ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¸)

---

## ğŸ› ï¸ Ğ’ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ (Supporting Tools)

Ğ’ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ñ‹Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ñ‹ ÑĞ»ÑƒĞ¶Ğ°Ñ‚ Ğ´Ğ»Ñ **Ğ¾Ğ±ÑĞ»ÑƒĞ¶Ğ¸Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸** Ğ¸ **Ğ½Ğµ ÑĞ²Ğ»ÑÑÑ‚ÑÑ Ñ‡Ğ°ÑÑ‚ÑŒÑ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°**:

### ĞĞ´Ğ°Ğ¿Ñ‚ĞµÑ€Ñ‹ Ğ¸ Ğ¡ĞµÑ€Ğ²Ğ¸ÑÑ‹

- **Usage Service** (`apps/otp/usage/`) - ÑĞ±Ğ¾Ñ€ Ğ¼ĞµÑ‚Ñ€Ğ¸Ğº Ğ¸ Ğ±Ğ¸Ğ»Ğ»Ğ¸Ğ½Ğ³

> **Note**: ĞĞ´Ğ°Ğ¿Ñ‚ĞµÑ€Ñ‹ Ğº Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼ LLM/API (OpenAI, Anthropic, CRM, RAG) Ñ€ĞµĞ°Ğ»Ğ¸Ğ·ÑƒÑÑ‚ÑÑ ĞºĞ°Ğº **Custom Provider Extensions** (ÑĞ¼. `docs/EXTENSIONS_API.md`). Ğ­Ñ‚Ğ¾ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ NATS-ÑĞµÑ€Ğ²Ğ¸ÑÑ‹, Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ¸Ñ€ÑƒĞµĞ¼Ñ‹Ğµ Ğ² Extension Registry.

### ĞšĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹ Ğ¸ Ğ¡Ñ…ĞµĞ¼Ñ‹

- **Proto Definitions** (`proto/beamline/`) - gRPC/Protobuf ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°ĞºÑ‚Ñ‹
- **SQL Schemas** (`sql/`) - PostgreSQL ÑÑ…ĞµĞ¼Ñ‹ Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸

### Ğ˜Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸

- **DevState** (`devstate/`) - ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸ĞµĞ¼ Ñ€Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ (.trae)
- **Scripts** (`scripts/`) - CI/CD, validation, checks
- **Tools** (`tools/`) - MCP servers, wrappers, utilities

### Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

- **Infrastructure** (`infra/`) - Docker, Kubernetes configs
- **Backend Shared** (`backend/`) - shared libraries
- **Documentation** (`docs/`) - Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

### ĞÑ€Ñ…Ğ¸Ğ²

- **Deprecated Solutions** (`deprecated-solutions/`) - ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸ (TypeScript Gateway, etc.)

---

## ğŸ“Š ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ ÑÑ…ĞµĞ¼Ğ° ÑĞ´Ñ€Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Clients                        â”‚
â”‚            (HTTP/REST requests)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         [1] C-Gateway (C11) - CORE              â”‚
â”‚         HTTP â†” NATS adapter (CP1)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ NATS
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      [2] Router (Erlang/OTP) - CORE             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Extension Registry + Routing Policy     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚  Pipeline: pre â†’ validator â†’ provider â†’ post    â”‚
â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚        â”‚        â”‚        â”‚
   â”‚ NATS   â”‚ NATS   â”‚ NATS   â”‚ NATS
   â–¼        â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Pre  â”‚ â”‚Valid.â”‚ â”‚Post  â”‚ â”‚Provider  â”‚
â”‚Ext   â”‚ â”‚Ext   â”‚ â”‚Ext   â”‚ â”‚Ext       â”‚
â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                            â”‚
   â”‚    [5] Extensions - CORE   â”‚
   â”‚                            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ [3] Worker  â”‚
         â”‚    (Rust)   â”‚
         â”‚   - CORE    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  [4] UI     â”‚
         â”‚ (SvelteKit) â”‚
         â”‚   - CORE    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ ĞŸÑ€Ğ¸Ğ½Ñ†Ğ¸Ğ¿Ñ‹ ÑĞ´Ñ€Ğ°

1. **ĞœĞ¸Ğ½Ğ¸Ğ¼Ğ°Ğ»Ğ¸Ğ·Ğ¼**: Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ 5 ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ² Ğ² ÑĞ´Ñ€Ğµ
2. **NATS-first**: Ğ’ÑÑ ĞºĞ¾Ğ¼Ğ¼ÑƒĞ½Ğ¸ĞºĞ°Ñ†Ğ¸Ñ Ñ‡ĞµÑ€ĞµĞ· NATS
3. **Pluggable**: Extensions Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ÑÑÑ‚ÑÑ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ
4. **Polyglot**: C11 (Gateway) + Erlang (Router) + C++ (Worker) + SvelteKit (UI)
5. **No-Drift**: ĞšĞ¾Ğ´ ÑĞ¾Ğ¾Ñ‚Ğ²ĞµÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸

---

## ğŸ“‹ Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾ Checkpoints

- âœ… **CP1-LC**: C-Gateway + Router (completed)
- âœ… **CP3-LC**: Worker CAF (completed)
- ğŸ”„ **CP4**: UI (in development)
- ğŸ“… **CP5**: Production Ready

---

## ğŸ“š Ğ¡Ğ²ÑĞ·Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ñ‹

- `README.md` - Ğ¾Ğ±Ñ‰Ğ¸Ğ¹ Ğ¾Ğ±Ğ·Ğ¾Ñ€ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ°
- `docs/EXTENSIONS_API.md` - API Ñ€Ğ°ÑÑˆĞ¸Ñ€ĞµĞ½Ğ¸Ğ¹
- `docs/ARCHITECTURE/` - Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ñ‹Ğµ ÑĞ¿ĞµÑ†Ğ¸Ñ„Ğ¸ĞºĞ°Ñ†Ğ¸Ğ¸
- `docs/ADR/ADR-016-c-gateway-migration.md` - Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ¾ C-Gateway
- `docs/ADR/ADR-010-target-architecture.md` - Ñ†ĞµĞ»ĞµĞ²Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ°

---

**Ğ’Ğ°Ğ¶Ğ½Ğ¾**: ĞŸÑ€Ğ¸ Ğ¾Ğ±ÑÑƒĞ¶Ğ´ĞµĞ½Ğ¸Ğ¸ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğ° BeamLine Constructor Ğ²ÑĞµĞ³Ğ´Ğ° Ñ€Ğ°Ğ·Ğ»Ğ¸Ñ‡Ğ°Ğ¹Ñ‚Ğµ **ÑĞ´Ñ€Ğ¾ Ğ¿Ñ€Ğ¾Ğ´ÑƒĞºÑ‚Ğ°** (5 ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ¾Ğ²) Ğ¸ **Ğ²ÑĞ¿Ğ¾Ğ¼Ğ¾Ğ³Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğµ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞ¼ĞµĞ½Ñ‚Ñ‹** (Ğ²ÑĞµ Ğ¾ÑÑ‚Ğ°Ğ»ÑŒĞ½Ğ¾Ğµ).
