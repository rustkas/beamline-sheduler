# BeamLine: Инварианты проекта

Этот документ фиксирует ключевые инварианты BeamLine как продукта. Он описывает то, что **не меняется** при эволюции архитектуры и tooling.

## 1. Цель продукта

- BeamLine — это **операционная система для AI-фабрик (AI Production Line)**.
- Фокус — **оркестрация живых исполнителей** (AI‑агенты, сервисы, люди), а не IDE, tooling или управление репозиторием.
- Мы строим **платформу‑оркестратор**, где ран‑ы и шаги выполняются предсказуемо, трассируемо и безопасно.

## 2. Границы продукта (что НЕ входит)

- **Управление состоянием разработки и историей `.trae/*` не является частью BeamLine.**
- **TRAE** — отдельная среда разработки, в которой живут `.trae/state.json` и `.trae/history.json`.
- **DevState** — отдельный побочный продукт для TRAE, который:
  - управляет и валидирует `.trae/*`;
  - проверяет HMAC‑цепочку и no‑drift;
  - НЕ является компонентом BeamLine и не входит в его product‑vision.

## 3. Контракты и ABI

- Единственный источник правды для межсервисных контрактов BeamLine — **gRPC + Protobuf ABI**.
- Пакеты версионируются (например, `beamline.orchestrator.v1`, `beamline.worker.v1`).
- В рамках одной версии допускаются только **неразрушающие изменения**; breaking‑изменения требуют новой версии.

## 4. Идентификаторы и трассируемость

- Каждое сообщение в BeamLine несёт:
  - `run_id`, `flow_id`, `step_id`, `trace_id`, `idempotency_key` (там, где применимо).
- Все критичные операции трассируются и логируются в структурированном JSON.
- HMAC‑цепочка и `.trae/history.json` относятся к слою TRAE/DevState, но BeamLine опирается на них как на внешний источник правды.

## 5. Безопасность и наблюдаемость

- Безопасность и observability — **инварианты по умолчанию**, а не “фича”:
  - защищённые каналы между сервисами;
  - авторизация по tenant/project/run;
  - структурированные JSON‑логи, health‑эндпоинты, трейсинг.
- Запрещено логировать секреты/PII; все чувствительные данные маскируются.

## 6. Checkpoints и эволюция

- Развитие BeamLine идёт через **Checkpoints (CP)** с формальными критериями.
- `.trae/state.json` и `.trae/history.json` отражают состояние CP и историю, но сами относятся к слою TRAE/DevState.
- Любое изменение контрактов/архитектуры должно быть:
  - согласовано с ABI/Proto;
  - задокументировано в ADR;
  - проверено buf‑breaking и state‑валидаторами.

---

Используйте этот документ как:
- ссылку в `README.md` и ADR;
- критерий при ревью архитектурных изменений;
- рамки при обсуждении роли tooling vs продукта.
